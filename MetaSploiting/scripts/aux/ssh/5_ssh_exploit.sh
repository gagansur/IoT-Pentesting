#!/bin/bash
## author @Gagandeep k sur
## email gks007@shsu.edu
## copyright @2022

# run search ssh on msfconsole using heredocs and /bin/bash
# heredoc can be used to write multiple commands that will be run in 
# /bin/bash using sudo

# run msfconsole command to search for that vulnerabilities
# in the database 
# generate a file with that vulnerability name
# file contains all the possible exploits for match the vulnerarability
sudo /bin/bash <<search_arg
command 2>/dev/null
msfconsole -q -x "search ssh">data/ssh.txt
search_arg

# if the file (NSS-1234.txt) is generated for the vulnerabilities (NSS-1234)
# it contains the names
# e.g. NSS-10234 -> auxiliary/scanner/ssh/ssh_login
if [[ -f data/ssh.txt ]]
then
# read the file and get second column, which contains exploit names 
vulnerabilities=$(awk 'BEGIN { FS=" " } { print $2 }' data/ssh.txt)

echo $vulnerabilities
for vulner in $vulnerabilities
do
# remove extra characters \\[45mssh\\[0m around ssh and replace it with ssh in the string
new_cmd=$(echo cmds/$vulner.sh| sed "s/\\[45mssh\\[0m/ssh/g")
echo $new_cmd
command ls -al $new_cmd
if [[ -f $new_cmd ]]
then	
# e.g. NSS-10234 -> auxiliary/scanner/ssh/ssh_login
echo $new_cmd
command $new_cmd	
break
fi
done
else
	echo "file doesnt exist"
fi

